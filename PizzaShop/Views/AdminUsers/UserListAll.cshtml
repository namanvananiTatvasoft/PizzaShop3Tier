@model IEnumerable<DAL.ViewModel.UserListModel>

@{
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "";
}


<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


<div class="user-list-container">

    <!-- search bar row -->
    <div class="row px-0 d-flex justify-content-between mb-3">
        <div class="col-sm-1 d-none d-sm-flex fs-2 fw-bold special-color">Users</div>
        <div class="col-sm-11 d-flex justify-content-center justify-content-sm-end">
            
            <div class="search-box d-flex align-items-center bg-white px-2 me-3 py-2 py-sm-0">
                <input type="text" placeholder="Search" id="searchInput" class="text-bark" value="@ViewBag.SearchKey" style="border: none !important; outline: none; !important">
                <img src="~/images/search.png" alt="" id="search-img" onclick="searchFunction()">
            </div>

            <a asp-action="AddUser" class="d-flex align-items-center justify-content-center px-3 px-sm-2 fs-6" id="add-user-btn" style="text-decoration: none;">
                <div class="d-flex align-items-center justify-content-center w-100 h-100">
                    + <span class="d-none d-sm-flex ms-2">Add User</span>
                </div>
            </a>

        </div>
    </div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 fw-semibold" id="deleteModalLabel">Delete Confirmation</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex justify-content-center align-items-center fw-semibold">
                Are you sure you want to delete this user?
            </div>
            <div class="modal-footer d-flex justify-content-center">
                <a id="deleteUserBtn" asp-action="DeleteUser" asp-controller="AdminUsers" asp-route-email="">
                    <button type="button" class="btn btn-primary">Yes</button>
                </a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
            </div>
        </div>
    </div>
</div>

    <div class="d-flex justify-content-end align-items-end align-items-md-center flex-column flex-md-row bg-white pe-2 pt-3 mb-6" style="">
            <div class="d-flex align-items-center mt-6 mb-3 mb-md-0">
                <label for="itemsPerPage" class="form-label me-3 text-center">Items per page:</label>
                <select id="itemsPerPage" class="form-select me-3" onchange="updateItemsPerPage()" style="width: 68px; height: 85%; font-size: 15px;">
                    @if (ViewBag.PageSize != null)
                    {
                        <option value="1" selected="@(ViewBag.PageSize == 1 ? true : false)">1</option>
                        <option value="2" selected="@(ViewBag.PageSize == 2 ? true : false)">2</option>
                        <option value="5" selected="@(ViewBag.PageSize == 5 ? true : false)">5</option>
                        <option value="10" selected="@(ViewBag.PageSize == 10 ? true : false)">10</option>
                        <option value="25" selected="@(ViewBag.PageSize == 25 ? true : false)">25</option>
                    }
                </select>
            </div>
            <div class="d-flex align-items-center me-3">
                <div class="me-2">
                    Showing 
                    @{
                        var startRecord = (ViewBag.PageNumber - 1) * ViewBag.PageSize + 1;
                        var endRecord = ViewBag.PageNumber * ViewBag.PageSize;
                        if (endRecord > ViewBag.Count) 
                            endRecord = ViewBag.Count;
                        
                        if(ViewBag.Count==0){
                            startRecord = 0;
                            endRecord = 0;
                        }
                    }
                    <span style="color: green;" class="me-1">@startRecord  -  @endRecord</span>  of  <span style="color: red;" class="ms-1">@ViewBag.Count</span>
                </div>
                <div style="height: 100%">
                    <a href="@Url.Action("UserListAll")?PageSize=@ViewBag.PageSize&PageNumber=@(ViewBag.PageNumber-1)&SortColumn=@ViewBag.SortColumn&SortDirection=@ViewBag.SortDirection&SearchKey=@ViewBag.SearchKey" style="text-decoration: none;">
                        <button style="width:38px; height: 40px; background-color: white; border: 1px solid black; border-radius: 3px;">&lt;</button>
                    </a>
                    <a href="@Url.Action("UserListAll")?PageSize=@ViewBag.PageSize&PageNumber=@(ViewBag.PageNumber+1)&SortColumn=@ViewBag.SortColumn&SortDirection=@ViewBag.SortDirection&SearchKey=@ViewBag.SearchKey">
                        <button style="width:38px; height: 40px; background-color: white; border: 1px solid black; border-radius: 3px;">&gt;</button>
                    </a>
                </div>
            </div>
        </div>

    <!-- User List Table -->
    <div class="row rounded user-list-table table-responsive bg-white pb-3 mt-6">

        <table class="table text-center align-items-center justify-content-center" id="user-list-table-list">
            <tbody>
                <tr>
                    <th scope="col" class="d-flex">
                        <div class="me-2">
                            Name 
                        </div>  
                        <i class="bi bi-arrow-down-up" id="arrowName" onclick="sortTable('Firstname')"></i>
                    </th>
                    <th scope="col">Email</th>
                    <th scope="col">Phone</th>
                    <th scope="col" class="d-flex justify-content-center">
                        <div class="me-2">
                            Role 
                        </div>  
                    <i class="bi bi-arrow-down-up" id="arrowRole" onclick="sortTable('Role')"></i>
                    </th>
                    <th scope="col">Status</th>
                    <th scope="col">Action</th>
                </tr>
                @foreach(var user in Model){
                    <tr>
                        <td>
                            <div class="d-flex justify-content-start align-items-center">
                                @if(user.Photourl != null){
                                    <img src="@user.Photourl" alt="user-pic" class="user-table-pic">
                                }
                                else{
                                    <img src="~/images/Default_pfp.svg.png" alt="~/images/Default_pfp.svg.png" class="user-table-pic">
                                }
                                <div>
                                    @user.Firstname @user.Lastname
                                </div>
                            </div>
                        </td>
                        <td>@user.Email</td>
                        <td>@user.Phone</td>
                        <td>@user.Role</td>

                        <td>
                            <div class="w-100 text-center">
                                <span class="@(user.Status == true? "active-user" : "inactive-user")">
                                    @(user.Status == true? "Active" : "Inactive")
                                </span>
                            </div>
                        </td>

                        <td>
                            <div class="d-flex justify-content-center align-items-center">
                                <a asp-action="EditUser" asp-controller="AdminUsers" asp-route-email="@user.Email" style="text-decoration: none;">
                                    <img src="~/images/pen.svg" alt="" class="edit-delete-pic">
                                </a>
                                <img src="~/images/trash.svg" alt="" class="edit-delete-pic" data-bs-toggle="modal" data-bs-target="#deleteModal" data-email = "@user.Email" onclick="deleteUser(this)">
                            </div>
                        </td>
                    </tr>
                }
                
            </tbody>
        </table>


    </div>
</div>

@* <script>
    function updateItemsPerPage() {
        console.log("Hi");
        var pageSize = document.getElementById("itemsPerPage").value; // Get the selected page size 

        window.location.href = '@Url.Action("UserListAll")' + '?PageSize=' + pageSize + &PageNumber=' + @ViewBag.PageNumber + '&SortColumn=' + @ViewBag.SortColumn + '&SortDirection=' + @ViewBag.SortDirection;
    }

    let currentSortColumn = '';
    let currentSortDirection = ''// Default direction

    function sortTable(column) {
        console.log("Hi");

        if('@ViewBag.SortDirection' === 'asc'){
            currentSortDirection = 'desc';
        }else{
            currentSortDirection = 'asc';
        }

        window.location.href = '@Url.Action("UserListAll")' + '?PageSize=' + @ViewBag.PageSize + &PageNumber=' + @ViewBag.PageNumber + '&SortColumn=' + column + '&SortDirection=' + currentSortColumn;
    }

</script> *@

<script>

    let currentSortColumn = '@ViewBag.SortColumn';  // Set this based on the current sort column
    let currentSortDirection = '@ViewBag.SortDirection';  // Set this based on the current sort direction

    function updateItemsPerPage() {
        console.log("Hi");
        var pageSize = document.getElementById("itemsPerPage").value; // Get the selected page size

        // Update the URL with the selected page size
        window.location.href = '@Url.Action("UserListAll")' + '?PageSize=' + pageSize + '&PageNumber=' + @ViewBag.PageNumber + '&SortColumn=' + '@ViewBag.SortColumn' + '&SortDirection=' + '@ViewBag.SortDirection'  + '&SearchKey=' + '@ViewBag.SearchKey';
    }

    function sortTable(column) {
        console.log("Sorting by " + column);

        // Toggle the sort direction
        if (currentSortDirection === 'asc') {
            currentSortDirection = 'desc';
        } else {
            currentSortDirection = 'asc';
        }

        // Update the URL with the new sorting parameters
        window.location.href = '@Url.Action("UserListAll")' + '?PageSize=' + @ViewBag.PageSize + '&PageNumber=' + 1 + '&SortColumn=' + column + '&SortDirection=' + currentSortDirection + '&SearchKey=' + '@ViewBag.SearchKey';
    }

    document.querySelector('#searchInput').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            var searchKey = document.getElementById("searchInput").value.toLowerCase();
            console.log(searchKey);
            window.location.href = '@Url.Action("UserListAll")' + '?PageSize=' + @ViewBag.PageSize + '&PageNumber=' + 1 + '&SortColumn=' + '@ViewBag.SortColumn' + '&SortDirection=' + '@ViewBag.SortDirection' + '&SearchKey=' + searchKey;
        }
    });

    function searchFunction()
    {
        var searchKey = document.getElementById("searchInput").value.toLowerCase();
        console.log(searchKey);
        window.location.href = '@Url.Action("UserListAll")' + '?PageSize=' + @ViewBag.PageSize + '&PageNumber=' + @ViewBag.PageNumber + '&SortColumn=' + '@ViewBag.SortColumn' + '&SortDirection=' + '@ViewBag.SortDirection' + '&SearchKey=' + searchKey;
    }

    function deleteUser(element) {
        var email = element.getAttribute("data-email");
        var deleteUserBtn = document.getElementById("deleteUserBtn");
        deleteUserBtn.href = '@Url.Action("DeleteUser", "AdminUsers")' + '?email=' + email;
    }
</script>



@section Scripts{
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
<script>

</script>


}





